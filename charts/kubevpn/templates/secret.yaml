apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubevpn.fullname" . }}
  namespace: {{ include "kubevpn.namespace" . }}
type: Opaque
{{- $secret := (lookup "v1" "Secret" (include "kubevpn.namespace" .) (include "kubevpn.fullname" .)) }}
{{- if $secret }}
data:
  {{- range $key, $value := $secret.data }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
{{- else }}
stringData:
  tls_crt: {{ .Values.tls.crt }}
  tls_key: {{ .Values.tls.key }}
  tls_server_name: {{ include "kubevpn.fullname" . }}.{{ include "kubevpn.namespace" . }}
{{- end }}

